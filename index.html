<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ikasoa by venwyhk</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">ikasoa</h1>
        <p class="header">ikasoa是一套SOA服务化治理解决方案.其中ikasoa-rpc是ikasoa的开源RPC框架,基于apache thrift开发,客户端可以像调用本地接口那样去调用远程接口.</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/venwyhk/ikasoa/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/venwyhk/ikasoa/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/venwyhk/ikasoa">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/venwyhk">venwyhk</a></p>


      </header>
      <section>
        <p><img src="https://raw.githubusercontent.com/venwyhk/ikasoa/master/ikasoalogo_small.png" alt=""><br> <b>Ikamobile Service Oriented Architecture</b></p>

<hr>

<p> <a href="https://codeship.com/projects/157977"><img src="https://codeship.com/projects/9cf2f150-1507-0134-ee57-3adebfc67210/status?branch=master" alt=""></a>  </p>

<h2>
<a id="概述" class="anchor" href="#%E6%A6%82%E8%BF%B0" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>概述</h2>

<p>ikasoa是一套SOA服务化治理解决方案.其中ikasoa-rpc是ikasoa的开源RPC框架,基于apache thrift开发,客户端可以像调用本地接口那样去调用远程接口.</p>

<h2>
<a id="开发运行环境要求" class="anchor" href="#%E5%BC%80%E5%8F%91%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>开发运行环境要求</h2>

<ul>
<li>要求java运行环境为java8</li>
</ul>

<h2>
<a id="目录说明" class="anchor" href="#%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>目录说明</h2>

<ul>
<li><p>ikasoa-core:<em>基础核心包</em></p></li>
<li><p>ikasoa-rpc:<em>RPC(远程过程调用协议)实现</em></p></li>
<li><p>ikasoa-example:<em>示例代码</em></p></li>
</ul>

<h2>
<a id="环境搭建" class="anchor" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>环境搭建</h2>

<ul>
<li>
<p>Maven配置</p>

<p>需要配置sonatype的Nexus服务器,并添加ikasoa的依赖:</p>
</li>
</ul>

<p>pom.xml</p>

<div class="highlight highlight-text-xml"><pre>    &lt;<span class="pl-ent">project</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://maven.apache.org/POM/4.0.0<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xsi</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="pl-pds">"</span></span> <span class="pl-e">xsi</span><span class="pl-e">:</span><span class="pl-e">schemaLocation</span>=<span class="pl-s"><span class="pl-pds">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd<span class="pl-pds">"</span></span>&gt;
        ......
        &lt;<span class="pl-ent">repositories</span>&gt;
            &lt;<span class="pl-ent">repository</span>&gt;
                &lt;<span class="pl-ent">id</span>&gt;ossrh&lt;/<span class="pl-ent">id</span>&gt;
                &lt;<span class="pl-ent">url</span>&gt;https://oss.sonatype.org/service/local/staging/deploy/maven2/&lt;/<span class="pl-ent">url</span>&gt;
            &lt;/<span class="pl-ent">repository</span>&gt;
        &lt;/<span class="pl-ent">repositories</span>&gt;
        &lt;<span class="pl-ent">pluginRepositories</span>&gt;
            &lt;<span class="pl-ent">pluginRepository</span>&gt;
                &lt;<span class="pl-ent">id</span>&gt;ossrh&lt;/<span class="pl-ent">id</span>&gt;
                &lt;<span class="pl-ent">url</span>&gt;https://oss.sonatype.org/service/local/staging/deploy/maven2/&lt;/<span class="pl-ent">url</span>&gt;
            &lt;/<span class="pl-ent">pluginRepository</span>&gt;
        &lt;/<span class="pl-ent">pluginRepositories</span>&gt;
        ......
        &lt;<span class="pl-ent">dependencies</span>&gt;
            ......
            <span class="pl-c">&lt;!-- 在这里添加对ikasoa的依赖 --&gt;</span>
            &lt;<span class="pl-ent">dependency</span>&gt;
                &lt;<span class="pl-ent">groupId</span>&gt;com.ikasoa&lt;/<span class="pl-ent">groupId</span>&gt;
                &lt;<span class="pl-ent">artifactId</span>&gt;ikasoa-rpc&lt;/<span class="pl-ent">artifactId</span>&gt;
                &lt;<span class="pl-ent">version</span>&gt;0.3-ALPHA&lt;/<span class="pl-ent">version</span>&gt;
            &lt;/<span class="pl-ent">dependency</span>&gt;
            ......
        &lt;/<span class="pl-ent">dependencies</span>&gt;
    &lt;/<span class="pl-ent">project</span>&gt;</pre></div>

<ul>
<li>
<p>导入工程&amp;编译代码</p>

<p>工程目录下命令行执行”mvn eclipse:eclipse”,并导入eclipse.(如果IDE非eclipse,则使用相对应的方式导入)</p>

<p>执行命令”mvn clean package”打包.</p>
</li>
</ul>

<h2>
<a id="helloworld" class="anchor" href="#helloworld" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>“helloworld”</h2>

<ul>
<li>
<p>创建接口和实现</p>

<p>新建例子接口(ExampleService.java),对象(ExampleVO.java)和实现 (ExampleServiceImpl.java)类:</p>
</li>
</ul>

<p>ExampleService.java</p>

<div class="highlight highlight-source-java"><pre>    <span class="pl-k">package</span> <span class="pl-smi">com.ikamobile.ikasoa.example.rpc</span>;
    <span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">ExampleService</span> {
        <span class="pl-c">// 查询对象</span>
        <span class="pl-k">public</span> <span class="pl-smi">ExampleVO</span> <span class="pl-en">findVO</span>(<span class="pl-k">int</span> <span class="pl-v">id</span>);
    }</pre></div>

<p>ExampleServiceImpl.java</p>

<div class="highlight highlight-source-java"><pre>    <span class="pl-k">package</span> <span class="pl-smi">com.ikamobile.ikasoa.example.rpc</span>;
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ExampleServiceImpl</span> <span class="pl-k">implements</span> <span class="pl-e">ExampleService</span> {
        <span class="pl-k">@Override</span>
        <span class="pl-k">public</span> <span class="pl-smi">ExampleVO</span> <span class="pl-en">findVO</span>(<span class="pl-k">int</span> <span class="pl-v">id</span>) {
            <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-smi">ExampleVO</span>(id, “helloworld”);
        }
    }</pre></div>

<p>ExampleVO.java</p>

<div class="highlight highlight-source-java"><pre>    <span class="pl-k">package</span> <span class="pl-smi">com.ikamobile.ikasoa.example.rpc</span>;
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ExampleVO</span> {
        <span class="pl-k">private</span> <span class="pl-k">int</span> id;
        <span class="pl-k">private</span> <span class="pl-smi">String</span> string;
        <span class="pl-k">public</span> <span class="pl-en">ExampleVO</span>() {
        }
        <span class="pl-k">public</span> <span class="pl-en">ExampleVO</span>(<span class="pl-k">int</span> <span class="pl-v">id</span>, <span class="pl-smi">String</span> <span class="pl-v">string</span>) {
            <span class="pl-v">this</span><span class="pl-k">.</span>id <span class="pl-k">=</span> id;
            <span class="pl-v">this</span><span class="pl-k">.</span>string <span class="pl-k">=</span> string;
        }
        <span class="pl-k">public</span> <span class="pl-k">int</span> <span class="pl-en">getId</span>() {
            <span class="pl-k">return</span> id;
        }
        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setId</span>(<span class="pl-k">int</span> <span class="pl-v">id</span>) {
            <span class="pl-v">this</span><span class="pl-k">.</span>id <span class="pl-k">=</span> id;
        }
        <span class="pl-k">public</span> <span class="pl-smi">String</span> <span class="pl-en">getString</span>() {
            <span class="pl-k">return</span> string;
        }
        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setString</span>(<span class="pl-smi">String</span> <span class="pl-v">string</span>) {
            <span class="pl-v">this</span><span class="pl-k">.</span>string <span class="pl-k">=</span> string;
        }
    }</pre></div>

<ul>
<li>创建执行类</li>
</ul>

<p>Main.java</p>

<div class="highlight highlight-source-java"><pre>    <span class="pl-k">package</span> <span class="pl-smi">com.ikamobile.ikasoa.example.rpc</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.rpc.DefaultIkasoaFactory</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.rpc.IkasoaException</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.rpc.IkasoaFactory</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.rpc.IkasoaServer</span>;
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Main</span> {
        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">main</span>(<span class="pl-k">String</span>[] <span class="pl-v">args</span>) {
            <span class="pl-smi">IkasoaFactory</span> ikasoaFactory <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>();
            <span class="pl-k">try</span> {
                <span class="pl-c">// 获取Ikasoa服务</span>
                <span class="pl-smi">IkasoaServer</span> ikasoaServer <span class="pl-k">=</span> ikasoaFactory<span class="pl-k">.</span>getIkasoaServer(<span class="pl-smi">ExampleServiceImpl</span><span class="pl-k">.</span>class, <span class="pl-c1">9999</span>);
                <span class="pl-c">// 服务端启动服务</span>
                ikasoaServer<span class="pl-k">.</span>run();
                <span class="pl-smi">Thread</span><span class="pl-k">.</span>sleep(<span class="pl-c1">100</span>);
                <span class="pl-c">// 客户端获取远程接口实现</span>
                <span class="pl-smi">ExampleService</span> es <span class="pl-k">=</span> ikasoaFactory<span class="pl-k">.</span>getIkasoaClient(<span class="pl-smi">ExampleService</span><span class="pl-k">.</span>class, <span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>, <span class="pl-c1">9999</span>);
                <span class="pl-c">// 客户端输出结果</span>
                <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(es<span class="pl-k">.</span>findVO(<span class="pl-c1">1</span>)<span class="pl-k">.</span>getString());
                <span class="pl-c">// 服务端停止服务</span>
                ikasoaServer<span class="pl-k">.</span>stop();
            } <span class="pl-k">catch</span> (<span class="pl-smi">IkasoaException</span> e) {
                e<span class="pl-k">.</span>printStackTrace();
            } <span class="pl-k">catch</span> (<span class="pl-smi">InterruptedException</span> e) {
                e<span class="pl-k">.</span>printStackTrace();
            }
        }
    }</pre></div>

<ul>
<li>
<p>执行Main.java</p>

<p>如输出”helloword”则表示执行成功.</p>

<p><em>可参考ikasoa-example的示例.</em></p>
</li>
</ul>

<h2>
<a id="使用示例" class="anchor" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用示例</h2>

<p><em>此示例程序需要使用到Spring框架.</em></p>

<ul>
<li>服务端例子</li>
</ul>

<p>bean.xml</p>

<div class="highlight highlight-text-xml"><pre>    &lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
    &lt;<span class="pl-ent">beans</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xsi</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">context</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/context<span class="pl-pds">"</span></span> <span class="pl-e">xsi</span><span class="pl-e">:</span><span class="pl-e">schemaLocation</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.1.xsd<span class="pl-pds">"</span></span>&gt;
        ......
        <span class="pl-c">&lt;!-- 服务端配置 --&gt;</span>
        &lt;<span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>rpcServer<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>example.ikasoa.RpcServer<span class="pl-pds">"</span></span> <span class="pl-e">init-method</span>=<span class="pl-s"><span class="pl-pds">"</span>run<span class="pl-pds">"</span></span> <span class="pl-e">destroy-method</span>=<span class="pl-s"><span class="pl-pds">"</span>stop<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">index</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">ref</span>=<span class="pl-s"><span class="pl-pds">"</span>ikasoaFactory<span class="pl-pds">"</span></span>/&gt;
            &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">index</span>=<span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">value</span>&gt;9993&lt;/<span class="pl-ent">value</span>&gt;<span class="pl-c">&lt;!-- 设置服务开放端口 --&gt;</span>
            &lt;/<span class="pl-ent">constructor-arg</span>&gt;
        &lt;/<span class="pl-ent">bean</span>&gt;
        &lt;<span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>ikasoaFactory<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.ikasoa.core.DefaultIkasoaFactory<span class="pl-pds">"</span></span>/&gt;
        ......
    &lt;/<span class="pl-ent">beans</span>&gt;</pre></div>

<p>RpcServer.java</p>

<div class="highlight highlight-source-java"><pre>    <span class="pl-k">package</span> <span class="pl-smi">example.ikasoa</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.rpc.IkasoaException</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.rpc.IkasoaFactory</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.rpc.IkasoaServer</span>;
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">RpcServer</span> {
        <span class="pl-k">private</span> <span class="pl-smi">IkasoaServer</span> server;
        <span class="pl-k">public</span> <span class="pl-en">RpcServer</span>(<span class="pl-smi">IkasoaFactory</span> <span class="pl-v">ikasoaFactory</span>, <span class="pl-k">int</span> <span class="pl-v">serverPort</span>) <span class="pl-k">throws</span> <span class="pl-smi">IkasoaException</span> {
            <span class="pl-c">// 实现类不能是抽象类</span>
            <span class="pl-v">this</span><span class="pl-k">.</span>server <span class="pl-k">=</span> ikasoaFactory<span class="pl-k">.</span>getIkasoaServer(<span class="pl-smi">ExampleServiceImpl</span><span class="pl-k">.</span>class, serverPort);
            <span class="pl-c">// 如果已有实例化后的对象(例如通过Spring注入的对象),则可以通过ImplClsCon类进行封装,ikasoa-rpc将会直接引用该类的实例,而不会重新实例化.</span>
            <span class="pl-c">// 例子如下:</span>
            <span class="pl-c">// this.server = ikasoaFactory.getIkasoaServer(new ImplClsCon(ExampleServiceImpl.class, exampleServiceImpl), serverPort);</span>
            <span class="pl-c">// 如有多个接口实现,可以传入List.</span>
            <span class="pl-c">// 例子如下:</span>
            <span class="pl-c">// List&lt;ImplClsCon&gt; sList = new ArrayList&lt;ImplClsCon&gt;();</span>
            <span class="pl-c">// sList.add(new ImplClsCon(ExampleServiceImpl.class));</span>
            <span class="pl-c">// sList.add(new ImplClsCon(Example2ServiceImpl.class));</span>
            <span class="pl-c">// IkasoaServer ikasoaServer = ikasoaFactory.getIkasoaServer(sList, port);</span>
            <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>服务端口:<span class="pl-pds">"</span></span> <span class="pl-k">+</span> serverPort);
            <span class="pl-k">for</span> (<span class="pl-smi">String</span> key <span class="pl-k">:</span> <span class="pl-v">this</span><span class="pl-k">.</span>server<span class="pl-k">.</span>getIkasoaServiceKeys()) {
                <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s"><span class="pl-pds">"</span>加载服务:<span class="pl-pds">"</span></span> <span class="pl-k">+</span> key);
            }
        }
        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">run</span>() {
            server<span class="pl-k">.</span>run();
        }
        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">stop</span>() {
            server<span class="pl-k">.</span>stop();
        }
    }</pre></div>

<ul>
<li>客户端例子</li>
</ul>

<p>RpcClient.java</p>

<div class="highlight highlight-source-java"><pre>    <span class="pl-k">package</span> <span class="pl-smi">example.ikasoa</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.rpc.DefaultIkasoaFactory</span>;
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">RpcClient</span> {
        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">main</span>(<span class="pl-k">String</span>[] <span class="pl-v">args</span>) {
            <span class="pl-c">// 如果接口之间有继承关系,则只需要配置子接口类</span>
            <span class="pl-c">// 设置服务器地址为”hocalhost”,端口为9993</span>
            <span class="pl-smi">ExampleService</span> es <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>()<span class="pl-k">.</span>getIkasoaClient(<span class="pl-smi">ExampleService</span><span class="pl-k">.</span>class, <span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>, <span class="pl-c1">9993</span>);
            <span class="pl-c">// 如果有多个服务提供者,服务器地址和端口也可以传入List,系统将自动执行负载均衡(默认负载均衡规则为轮询,此外还支持随机,详见'负载均衡'文档目录).</span>
            <span class="pl-c">// 例子如下:</span>
            <span class="pl-c">//  List&lt;ServerInfo&gt; serverInfoList = new ArrayList&lt;ServerInfo&gt;();</span>
            <span class="pl-c">//  serverInfoList.add(new ServerInfo("localhost", 9993));</span>
            <span class="pl-c">//  serverInfoList.add(new ServerInfo("192.168.1.41", 9993));</span>
            <span class="pl-c">//  ExampleService es = new DefaultIkasoaFactory().getIkasoaClient(ExampleService.class, serverInfoList);</span>
            <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(es<span class="pl-k">.</span>findVO(<span class="pl-c1">1</span>)<span class="pl-k">.</span>getString());
        }
    }</pre></div>

<ul>
<li>
<p>执行RpcClient.java</p>

<p>如输出”helloword”则表示执行成功.</p>
</li>
</ul>

<h2>
<a id="thrift使用示例" class="anchor" href="#thrift%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Thrift使用示例</h2>

<ul>
<li>客户端调用Thrift服务端例子</li>
</ul>

<p>ThriftClientDemo.java</p>

<div class="highlight highlight-source-java"><pre>    <span class="pl-k">package</span> <span class="pl-smi">example.ikasoa</span>;
    <span class="pl-k">import</span> <span class="pl-smi">org.apache.thrift.transport.TTransport</span>;
    <span class="pl-k">import</span> <span class="pl-smi">org.apache.thrift.transport.TTransportFactory</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.core.thrift.client.ThriftClient</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.core.thrift.client.ThriftClientConfiguration</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.ikasoa.rpc.DefaultIkasoaFactory</span>;
    <span class="pl-k">import</span> <span class="pl-smi">com.ikamobile.tmcs.controller.thrift.server.acceptor.GeneralThriftAcceptor</span>;
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ThriftClientDemo</span> {
        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">main</span>(<span class="pl-k">String</span>[] <span class="pl-v">args</span>) {
            <span class="pl-smi">ThriftClientConfiguration</span> configuration <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">ThriftClientConfiguration</span>();
            configuration<span class="pl-k">.</span>setTransportFactory(<span class="pl-k">new</span> <span class="pl-smi">TTransportFactory</span>()); <span class="pl-c">// 协议需要与服务端匹配</span>
            <span class="pl-c">// 如果只依赖ikasoa-core,这里也可以使用com.ikamobile.ikasoa.core.thrift.GeneralFactory来替代DefaultIkasoaFactory</span>
            <span class="pl-smi">ThriftClient</span> thriftClient <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>(configuration)<span class="pl-k">.</span>getThriftClient(<span class="pl-s"><span class="pl-pds">"</span>121.40.119.240<span class="pl-pds">"</span></span>, <span class="pl-c1">9201</span>); <span class="pl-c">// 配置Thrift的服务器地址和端口</span>
            <span class="pl-smi">TTransport</span> transport <span class="pl-k">=</span> <span class="pl-c1">null</span>;
            <span class="pl-k">try</span> {
                transport <span class="pl-k">=</span> thriftClient<span class="pl-k">.</span>getTransport();
                transport<span class="pl-k">.</span>open();
                <span class="pl-c">// GeneralThriftAcceptor为IDL中配置的service</span>
                <span class="pl-smi">GeneralThriftAcceptor</span><span class="pl-k">.</span><span class="pl-smi">Client</span> client <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">GeneralThriftAcceptor</span>.<span class="pl-smi">Client</span>(
                thriftClient<span class="pl-k">.</span>getProtocol(transport, <span class="pl-s"><span class="pl-pds">"</span>GeneralThriftAcceptor<span class="pl-pds">"</span></span>)); <span class="pl-c">// 参数"GeneralThriftAcceptor"为服务的key,如果没有则可以不传</span>
                <span class="pl-c">// 打印结果</span>
                <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(client<span class="pl-k">.</span>getTmc(<span class="pl-c1">1</span>));
            } <span class="pl-k">catch</span> (<span class="pl-smi">Exception</span> e) {
                e<span class="pl-k">.</span>printStackTrace();
            } <span class="pl-k">finally</span> {
                transport<span class="pl-k">.</span>close();
            }
        }
    }</pre></div>

<ul>
<li>Spring配置Thrift服务端例子</li>
</ul>

<div class="highlight highlight-text-xml"><pre>    &lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
    &lt;<span class="pl-ent">beans</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xsi</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">context</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/context<span class="pl-pds">"</span></span> <span class="pl-e">xsi</span><span class="pl-e">:</span><span class="pl-e">schemaLocation</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd<span class="pl-pds">"</span></span>&gt;
        ......
        <span class="pl-c">&lt;!-- Thrift服务配置 --&gt;</span>
        &lt;<span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftServer2<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.ikasoa.core.thrift.server.impl.DefaultThriftServerImpl<span class="pl-pds">"</span></span> <span class="pl-e">init-method</span>=<span class="pl-s"><span class="pl-pds">"</span>run<span class="pl-pds">"</span></span> <span class="pl-e">destroy-method</span>=<span class="pl-s"><span class="pl-pds">"</span>stop<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>serverName<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>xxxServer<span class="pl-pds">"</span></span> /&gt;<span class="pl-c">&lt;!-- 服务名称 --&gt;</span>
            &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>serverPort<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>9899<span class="pl-pds">"</span></span> /&gt;<span class="pl-c">&lt;!-- 服务端口 --&gt;</span>
            &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftServerConfiguration<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.ikasoa.core.thrift.server.ThriftServerConfiguration<span class="pl-pds">"</span></span>&gt;
                    &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>transportFactory<span class="pl-pds">"</span></span>&gt;<span class="pl-c">&lt;!-- 指定传输协议工厂(可选,默认为TFramedTransport.Factory) --&gt;</span>
                        &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>org.apache.thrift.transport.TTransportFactory<span class="pl-pds">"</span></span> /&gt;
                    &lt;/<span class="pl-ent">property</span>&gt;
                &lt;/<span class="pl-ent">bean</span>&gt;
            &lt;/<span class="pl-ent">property</span>&gt;
            &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>processor<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.xxx.service.ThriftService.Processor<span class="pl-pds">"</span></span>&gt;<span class="pl-c">&lt;!-- ThriftService为通过idl生成的服务类 --&gt;</span>
                    &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">ref</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftService<span class="pl-pds">"</span></span> /&gt;
                &lt;/<span class="pl-ent">bean</span>&gt;
            &lt;/<span class="pl-ent">property</span>&gt;
        &lt;/<span class="pl-ent">bean</span>&gt;
        &lt;<span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftService<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.xxx.ThriftServiceImpl<span class="pl-pds">"</span></span>/&gt;<span class="pl-c">&lt;!-- ThriftService.Iface接口的实现 --&gt;</span>
        ......
    &lt;/<span class="pl-ent">beans</span>&gt;</pre></div>

<ul>
<li>Spring配置Thrift服务端例子(嵌套方式)</li>
</ul>

<div class="highlight highlight-text-xml"><pre>    &lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
    &lt;<span class="pl-ent">beans</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xsi</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">context</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/context<span class="pl-pds">"</span></span> <span class="pl-e">xsi</span><span class="pl-e">:</span><span class="pl-e">schemaLocation</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd<span class="pl-pds">"</span></span>&gt;
        ......
        <span class="pl-c">&lt;!-- Thrift服务配置(嵌套方式) --&gt;</span>
        &lt;<span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftServer1<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.ikasoa.core.thrift.server.impl.DefaultThriftServerImpl<span class="pl-pds">"</span></span> <span class="pl-e">init-method</span>=<span class="pl-s"><span class="pl-pds">"</span>run<span class="pl-pds">"</span></span> <span class="pl-e">destroy-method</span>=<span class="pl-s"><span class="pl-pds">"</span>stop<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>serverName<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>xxxServer<span class="pl-pds">"</span></span> /&gt;<span class="pl-c">&lt;!-- 服务名称 --&gt;</span>
            &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>serverPort<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>9898<span class="pl-pds">"</span></span> /&gt;<span class="pl-c">&lt;!-- 服务端口 --&gt;</span>
            &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftServerConfiguration<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.ikasoa.core.thrift.server.ThriftServerConfiguration<span class="pl-pds">"</span></span>&gt;
                    &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>transportFactory<span class="pl-pds">"</span></span>&gt;<span class="pl-c">&lt;!-- 指定传输协议工厂(可选,默认为TFramedTransport.Factory) --&gt;</span>
                        &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>org.apache.thrift.transport.TTransportFactory<span class="pl-pds">"</span></span> /&gt;
                    &lt;/<span class="pl-ent">property</span>&gt;
                &lt;/<span class="pl-ent">bean</span>&gt;
            &lt;/<span class="pl-ent">property</span>&gt;
            &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>processor<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.ikasoa.core.thrift.server.MultiplexedProcessor<span class="pl-pds">"</span></span>&gt;
                    &lt;<span class="pl-ent">constructor-arg</span>&gt;
                        &lt;<span class="pl-ent">map</span>&gt;
                            &lt;<span class="pl-ent">entry</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>Service1<span class="pl-pds">"</span></span>&gt;<span class="pl-c">&lt;!-- 这里的key可以随便取,保证唯一就行,Client调用的时候需要用 --&gt;</span>
                                &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.xxx.service.ThriftService1.Processor<span class="pl-pds">"</span></span>&gt;<span class="pl-c">&lt;!-- ThriftService1和ThriftService2为通过idl生成的服务类 --&gt;</span>
                                    &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">ref</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftService1<span class="pl-pds">"</span></span> /&gt;
                                &lt;/<span class="pl-ent">bean</span>&gt;
                            &lt;/<span class="pl-ent">entry</span>&gt;
                            &lt;<span class="pl-ent">entry</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>Service2<span class="pl-pds">"</span></span>&gt;
                                &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.xxx.service.ThriftService2.Processor<span class="pl-pds">"</span></span>&gt;
                                    &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">ref</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftService2<span class="pl-pds">"</span></span> /&gt;
                                &lt;/<span class="pl-ent">bean</span>&gt;
                            &lt;/<span class="pl-ent">entry</span>&gt;
                        &lt;/<span class="pl-ent">map</span>&gt;
                    &lt;/<span class="pl-ent">constructor-arg</span>&gt;
                &lt;/<span class="pl-ent">bean</span>&gt;
            &lt;/<span class="pl-ent">property</span>&gt;
        &lt;/<span class="pl-ent">bean</span>&gt;
        &lt;<span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftService1<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.xxx.ThriftService1Impl<span class="pl-pds">"</span></span>/&gt;<span class="pl-c">&lt;!-- ThriftService1.Iface接口的实现 --&gt;</span>
        &lt;<span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>thriftService2<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.xxx.ThriftService2Impl<span class="pl-pds">"</span></span>/&gt;<span class="pl-c">&lt;!-- ThriftService2.Iface接口的实现 --&gt;</span>
        ......
    &lt;/<span class="pl-ent">beans</span>&gt;</pre></div>

<h2>
<a id="服务实现类型" class="anchor" href="#%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB%E5%9E%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>服务实现类型</h2>

<p><em>Ikasoa默认使用Thrift作为服务类型的实现,但也提供了Netty以供选择.</em></p>

<ul>
<li>使用Thrift服务</li>
</ul>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c1">......</span>
    <span class="pl-smi">IkasoaFactory</span> ikasoaFactory <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>();
    <span class="pl-c1">......</span></pre></div>

<ul>
<li>使用Netty服务</li>
</ul>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c1">......</span>
    <span class="pl-smi">IkasoaFactory</span> ikasoaFactory <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">NettyIkasoaFactory</span>();
    <span class="pl-c1">......</span></pre></div>

<h2>
<a id="负载均衡" class="anchor" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>负载均衡</h2>

<p><em>Ikasoa提供了2种负载均衡,分别为轮循(含权重)和随机,默认使用轮循.</em></p>

<ul>
<li>选择轮循负载均衡(默认)</li>
</ul>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c1">......</span>
    <span class="pl-smi">XService</span> xs <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>()<span class="pl-k">.</span>getIkasoaClient(<span class="pl-smi">XService</span><span class="pl-k">.</span>class, serverInfoList);
    <span class="pl-c">// 也可以写为如下方式:</span>
    <span class="pl-c">// Class loadBalanceClass = Class.forName("com.ikamobile.ikasoa.core.loadbalance.impl.PollingLoadBalanceImpl");</span>
    <span class="pl-c">// XService xs = new DefaultIkasoaFactory().getIkasoaClient(XService.class, serverInfoList, loadBalanceClass);</span>
    <span class="pl-c1">......</span></pre></div>

<p><em>serverInfoList中的元素对象com.ikamobile.ikasoa.core.loadbalance.ServerInfo定义了单个服务信息,其中weightNumber属性为权重值,用于轮循负载均衡.</em></p>

<ul>
<li>选择随机负载均衡</li>
</ul>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c1">......</span>
    <span class="pl-smi">Class</span> loadBalanceClass <span class="pl-k">=</span> <span class="pl-smi">Class</span><span class="pl-k">.</span>forName(<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.ikasoa.core.loadbalance.impl.RandomLoadBalanceImpl<span class="pl-pds">"</span></span>);
    <span class="pl-smi">XService</span> xs <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>()<span class="pl-k">.</span>getIkasoaClient(<span class="pl-smi">XService</span><span class="pl-k">.</span>class, serverInfoList, loadBalanceClass);
    <span class="pl-c1">......</span></pre></div>

<ul>
<li>
<p>自定义负载均衡</p>

<p>创建自定义序列化类(例如com.xxx.XLoadBalanceImpl).</p>

<p>自定义序列化类(com.xxx.XLoadBalanceImpl)需实现接口com.ikamobile.ikasoa.core.loadbalance.LoadBalance.</p>

<p>通过如下方式获取服务:</p>
</li>
</ul>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c1">......</span>
    <span class="pl-smi">Class</span> loadBalanceClass <span class="pl-k">=</span> <span class="pl-smi">Class</span><span class="pl-k">.</span>forName(<span class="pl-s"><span class="pl-pds">"</span>com.xxx.XLoadBalanceImpl<span class="pl-pds">"</span></span>);
    <span class="pl-smi">XService</span> xs <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>()<span class="pl-k">.</span>getIkasoaClient(<span class="pl-smi">XService</span><span class="pl-k">.</span>class, serverInfoList, loadBalanceClass);
    <span class="pl-c1">......</span></pre></div>

<h2>
<a id="序列化" class="anchor" href="#%E5%BA%8F%E5%88%97%E5%8C%96" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>序列化</h2>

<p><em>Ikasoa提供了3种序列化方式,分别为fastjson,xml,kryo,默认使用fastjson.</em></p>

<ul>
<li>选择fastjson作为序列化方式(默认)</li>
</ul>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c1">......</span>
    <span class="pl-smi">IkasoaFactory</span> ikasoaFactory <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>();
    <span class="pl-c">// 也可以写为如下方式:</span>
    <span class="pl-c">// Class protocolHandlerClass = Class.forName("com.ikamobile.ikasoa.rpc.handler.impl.JsonProtocolHandlerImpl");</span>
    <span class="pl-c">// IkasoaFactory ikasoaFactory = new DefaultIkasoaFactory(new Configurator(protocolHandlerClass));</span>
    <span class="pl-c1">......</span></pre></div>

<ul>
<li>选择xml作为序列化方式</li>
</ul>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c1">......</span>
    <span class="pl-smi">Class</span> protocolHandlerClass <span class="pl-k">=</span> <span class="pl-smi">Class</span><span class="pl-k">.</span>forName(<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.ikasoa.rpc.handler.impl.XmlProtocolHandlerImpl<span class="pl-pds">"</span></span>);
    <span class="pl-smi">IkasoaFactory</span> ikasoaFactory <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>(<span class="pl-k">new</span> <span class="pl-smi">Configurator</span>(protocolHandlerClass));
    <span class="pl-c1">......</span></pre></div>

<ul>
<li>选择kryo作为序列化方式</li>
</ul>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c1">......</span>
    <span class="pl-smi">Class</span> protocolHandlerClass <span class="pl-k">=</span> <span class="pl-smi">Class</span><span class="pl-k">.</span>forName(<span class="pl-s"><span class="pl-pds">"</span>com.ikamobile.ikasoa.rpc.handler.impl.KryoProtocolHandlerImpl<span class="pl-pds">"</span></span>);
    <span class="pl-smi">IkasoaFactory</span> ikasoaFactory <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>(<span class="pl-k">new</span> <span class="pl-smi">Configurator</span>(protocolHandlerClass));
    <span class="pl-c1">......</span></pre></div>

<ul>
<li>
<p>自定义序列化方式</p>

<p>创建自定义序列化类(例如com.xxx.XProtocolHandlerImpl).</p>

<p>自定义序列化类(com.xxx.XProtocolHandlerImpl)需实现接口com.ikamobile.ikasoa.rpc.handler.ProtocolHandler.</p>

<p>通过如下方式获取IkasoaFactory:</p>
</li>
</ul>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c1">......</span>
    <span class="pl-smi">Class</span> protocolHandlerClass <span class="pl-k">=</span> <span class="pl-smi">Class</span><span class="pl-k">.</span>forName(<span class="pl-s"><span class="pl-pds">"</span>com.xx.XProtocolHandlerImpl<span class="pl-pds">"</span></span>);
    <span class="pl-smi">IkasoaFactory</span> ikasoaFactory <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">DefaultIkasoaFactory</span>(<span class="pl-k">new</span> <span class="pl-smi">Configurator</span>(protocolHandlerClass));
    <span class="pl-c1">......</span></pre></div>

<h2>
<a id="注意事项" class="anchor" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>注意事项</h2>

<ul>
<li><p>使用fastjson作为序列化方式时,fastjson依赖版本建议与ikasoa所依赖的版本一致(当前为1.2.12).否则可能出现服务名不能匹配,无法调用服务的情况.</p></li>
<li><p>使用kryo作为序列化方式时,如果参数或返回值以父类(或抽象类)的形式传递,转换为子类时可能会丢失子类属性值,建议尽量以子类形式传递参数.fastjson方式非集合类参数或返回值没有问题,xml方式都没有问题.</p></li>
<li><p>使用fastjson作为序列化方式时,传递的Bean对象必须要有默认构造方法(建议使用类似lombok这样的工具来处理Bean对象).</p></li>
<li><p>使用kryo作为序列化方式时,暂不支持自定义异常对象,如果抛出自定义异常对象,异常类型不能正确识别.</p></li>
<li><p>部分单元测试需要启动Socket,执行单元测试时请确保相关端口可用.</p></li>
</ul>

<hr>

<p><em><a href="mailto:larry7696@gmail.com">larry7696@gmail.com</a> | 2016-08-10</em></p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
